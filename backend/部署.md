我分析了整个后端项目代码，以下是部署到服务器需要的配置和依赖:

## 核心依赖

从`requirements.txt`来看，项目的核心依赖已经列出：
```
fastapi==0.104.1
python-multipart==0.0.6
httpx==0.25.1
python-dotenv==1.0.0
uvicorn==0.24.0
google-cloud-translate==3.11.1
google-generativeai
python-docx
python-pptx
PyPDF2
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.12.1
```

但有一些可能缺失的依赖：
1. `markdown` 和 `bs4` (BeautifulSoup4) - 在`document_processor.py`中用于处理Markdown文件
2. `tenacity` - 在`term_extractor.py`中用于重试逻辑
3. `pypdf` - `document_processor.py`中使用的是`PdfReader`，看起来是从`pypdf`导入而非`PyPDF2`

## 数据库配置

项目使用PostgreSQL数据库，从`database.py`可以看出需要以下配置：
- 数据库名：在`.env`中的`POSTGRES_DB`设置
- 用户名/密码：在`.env`中的`POSTGRES_USER`和`POSTGRES_PASSWORD`设置
- 主机/端口：在`.env`中的`POSTGRES_HOST`和`POSTGRES_PORT`设置
- 连接池配置：包括`POSTGRES_POOL_SIZE`、`POSTGRES_MAX_OVERFLOW`、`POSTGRES_POOL_TIMEOUT`和`POSTGRES_POOL_RECYCLE`

## API密钥与外部服务

项目依赖几个关键的外部API：
1. **DeepL API**：用于翻译，需要在`.env`中设置`DEEPL_API_KEY`和`DEEPL_API_TYPE`
2. **Google Gemini API**：用于术语提取，需要在`.env`中设置`GEMINI_API_KEY`

## 目录和权限

项目需要以下目录及权限：
1. `cache/` 目录用于缓存术语表和临时文件
2. 确保运行服务的用户对这些目录有读写权限

## 服务器部署步骤修正

1. **安装系统依赖**：
```bash
sudo apt update
sudo apt install python3 python3-pip python3-venv postgresql postgresql-contrib nginx
```

2. **安装Python依赖**：
```bash
pip install -r requirements.txt
# 添加缺失依赖
pip install markdown beautifulsoup4 tenacity pypdf
```

3. **PostgreSQL数据库设置**：
```bash
sudo -u postgres psql
CREATE DATABASE translation;
CREATE USER cargoppt_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE translation TO cargoppt_user;
\q
```

4. **执行数据库迁移**：
```bash
# 确保alembic配置正确
cd /path/to/backend
alembic upgrade head
```

5. **配置环境变量**：
确保`.env`文件包含全部必要配置：
```
DEEPL_API_KEY=your-deepl-api-key
DEEPL_API_TYPE=pro  # 或 free
GEMINI_API_KEY=your-gemini-api-key
POSTGRES_USER=cargoppt_user
POSTGRES_PASSWORD=your_secure_password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=translation
POSTGRES_POOL_SIZE=5
POSTGRES_MAX_OVERFLOW=10
POSTGRES_POOL_TIMEOUT=30
POSTGRES_POOL_RECYCLE=1800
```

6. **创建并配置服务**：
```bash
sudo nano /etc/systemd/system/cargoppt.service
```

添加以下内容：
```
[Unit]
Description=CargoPPT Translation API Service
After=network.target postgresql.service

[Service]
User=www-data
Group=www-data
WorkingDirectory=/path/to/backend
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

7. **启动服务**：
```bash
sudo systemctl enable cargoppt
sudo systemctl start cargoppt
```

8. **配置Nginx**：
```
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## 可能需要注意的其他事项

1. **内存要求**：
   - 由于使用Gemini和处理大文件，至少4GB RAM，建议8GB或更多

2. **存储空间**：
   - 需要足够空间存储上传的文档和术语表缓存
   - 推荐至少20GB可用空间

3. **网络访问**：
   - 确保服务器能访问DeepL API和Google Gemini API
   - 可能需要配置防火墙允许这些出站连接

4. **备份策略**：
   - 设置定期备份PostgreSQL数据库
   - 考虑备份术语表缓存目录

5. **日志配置**：
   - 项目使用Python的`logging`模块
   - 考虑配置日志轮换以避免日志文件过大




2. 关于服务配置和文本内容:
- 服务配置文件应该添加到 `/etc/systemd/system/cargoppt.service`
- 创建该文件并添加以下内容:

```ini
[Unit]
Description=CargoPPT 翻译服务
After=network.target

[Service]
User=你的用户名
WorkingDirectory=/你的项目路径/CargoPPT/backend
Environment="PATH=/你的conda环境路径/bin"
ExecStart=/你的conda环境路径/bin/uvicorn main:app --host 0.0.0.0 --port 8000

[Install]
WantedBy=multi-user.target
```

3. 关于 Nginx 配置:
- Nginx 配置文件应该添加到 `/etc/nginx/sites-available/cargoppt`，并创建软链接到 `/etc/nginx/sites-enabled/`
- 推荐的 Nginx 配置如下:

```nginx
server {
    listen 80;
    server_name 你的域名.com;

    location / {
        root /你的项目路径/CargoPPT/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

配置完成后需要执行的命令:

1. 对于服务配置:
```bash
# 启用服务
sudo systemctl enable cargoppt
# 启动服务
sudo systemctl start cargoppt
```

2. 对于 Nginx 配置:
```bash
# 创建配置软链接
sudo ln -s /etc/nginx/sites-available/cargoppt /etc/nginx/sites-enabled/
# 测试 Nginx 配置
sudo nginx -t
# 重启 Nginx 服务
sudo systemctl restart nginx
```

如果您需要对这些配置进行任何澄清或有其他问题，请随时告诉我！

