(base) ellisfrancis@Elliss-MacBook-Pro CargoPPT % ssh -i ~/.ssh/cargoppt/cargoppt_server.pem root@8.215.32.251 -p 22
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)

1. **首先在服务器安装必要的软件**：
```bash
# 安装 Node.js 和 npm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装 Nginx
sudo apt update
sudo apt install nginx
```

2. **前端项目构建准备**：
在本地开发环境中，需要修改生产环境配置文件 `.env.production`：
```bash
# frontend/.env.production
VITE_API_BASE_URL=http://8.215.32.251:8000  # 改为您的服务器IP和后端端口
```

3. **构建前端项目**：
在本地执行：
```bash
cd frontend
npm install
npm run build
```
这将在 `dist` 目录生成生产环境的静态文件。

4. **将构建文件同步到服务器**：
```bash
# 在本地执行，将构建后的文件传输到服务器
rsync -avz --delete \
    -e "ssh -i ~/.ssh/cargoppt/cargoppt_server.pem -p 56222" \
    ./dist/ root@8.215.32.251:/var/www/CargoTranslator/frontend/dist/
```

5. **配置 Nginx**：
在服务器上创建 Nginx 配置文件：
```bash
sudo vim /etc/nginx/sites-available/cargoppt
```

添加以下配置：
```nginx
server {
    listen 80;
    server_name 8.215.32.251;

    # 前端静态文件
    location / {
        root /var/www/CargoTranslator/frontend/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 后端API代理 - 修改这部分
    location /api/ {  # 添加末尾斜杠
        proxy_pass http://127.0.0.1:8000/api/;  # 添加 /api/
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}
```

6. **启用 Nginx 配置**：
```bash
# 创建符号链接
sudo ln -s /etc/nginx/sites-available/cargoppt /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 如果测试通过，重启 Nginx
sudo systemctl restart nginx
```

7. **设置目录权限**：
```bash
# 设置正确的目录权限
sudo chown -R www-data:www-data /var/www/CargoTranslator/frontend
sudo chmod -R 755 /var/www/CargoTranslator/frontend
```

8. **验证部署**：
访问 http://8.215.32.251 （您的服务器IP）应该能看到前端页面。

完整的目录结构将是：
```
/var/www/CargoTranslator/
├── frontend/
│   └── dist/        # 前端构建文件
├── backend/         # 后端应用
└── logs/           # 日志目录
```

注意事项：
1. 确保服务器防火墙允许 80 端口（HTTP）访问
2. 如果使用域名，需要将域名解析到服务器IP
3. 建议后续配置 HTTPS
4. 可以考虑配置 CDN 来提升访问速度




如果更改前端：
明白，您想使用域名来访问网站而不是 IP 地址。这需要以下步骤：

1. 首先，需要购买并配置域名：
   - 购买一个域名（比如通过阿里云、腾讯云等）
   - 在域名管理后台添加 DNS 解析记录：
     ```
     类型: A
     主机记录: @ 或 www（或其他子域名）
     记录值: 8.215.32.251
     ```

2. 修改 Nginx 配置，将 `server_name` 改为您的域名：
```nginx
server {
    listen 80;
    server_name https://translation.jtcargo.co.id;  # 修改为您的域名

    # 前端静态文件
    location / {
        root /var/www/CargoTranslator/frontend/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 后端API代理
    location /api/ {
        proxy_pass http://127.0.0.1:8000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}

# 可选：添加 IP 访问重定向
server {
    listen 80;
    server_name 8.215.32.251;
    return 301 $scheme://your-domain.com$request_uri;  # 将 IP 访问重定向到域名
}
```

3. 修改前端环境配置 `.env.production`：
```
VITE_API_BASE_URL='https://your-domain.com'  # 如果配置了 HTTPS
# 或
VITE_API_BASE_URL='http://your-domain.com'   # 如果只用 HTTP
```

4. 建议配置 HTTPS：
```nginx
server {
    listen 443 ssl;
    server_name your-domain.com www.your-domain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # SSL 配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # 其他配置保持不变
    location / {
        root /var/www/CargoTranslator/frontend/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    location /api/ {
        proxy_pass http://127.0.0.1:8000/api/;
        # ... 其他代理配置 ...
    }
}

# HTTP 重定向到 HTTPS
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

5. 应用更改：
```bash
# 测试 Nginx 配置
sudo nginx -t

# 如果测试通过，重启 Nginx
sudo systemctl restart nginx

# 重新构建前端
cd /var/www/CargoTranslator/frontend
npm run build
```

这样配置后：
1. 用户只能通过域名访问网站
2. IP 地址访问会被重定向到域名
3. 可以配置 HTTPS 提供更安全的访问
4. 更专业的网站形象



后续调整：
增加了自动翻译文本：
```bash
npm install lodash
npm install --save-dev @types/lodash  # TypeScript 类型定义




# /etc/nginx/sites-available/cargoppt

# 将 IP 访问重定向到域名
server {
    listen 80;
    server_name 8.215.32.251;
    return 301 https://translation.jtcargo.co.id$request_uri;
}

# 将 HTTP 重定向到 HTTPS
server {
    listen 80;
    server_name translation.jtcargo.co.id;
    return 301 https://$server_name$request_uri;
}

# 主服务配置（HTTPS）
server {
    listen 443 ssl;
    server_name translation.jtcargo.co.id;

    # SSL 配置（certbot 会自动添加这些）
    ssl_certificate /etc/letsencrypt/live/translation.jtcargo.co.id/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/translation.jtcargo.co.id/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    client_max_body_size 30M;
    proxy_read_timeout 300;
    proxy_connect_timeout 300;
    proxy_send_timeout 300;

    # 前端静态文件
    location / {
        root /var/www/CargoTranslator/frontend/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 后端API代理
    location /api/ {
        proxy_pass http://127.0.0.1:8000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}





最新配置备份
server {
    listen 80;
    server_name 8.215.32.251;
    return 301  translation.jtcargo.co.id;

    client_max_body_size 30M;  # 允许最大30MB的上传
    proxy_read_timeout 300;
    proxy_connect_timeout 300;
    proxy_send_timeout 300;

    # 前端静态文件
    location / {
        root /var/www/CargoTranslator/frontend/dist;
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # 后端API代理 - 修改这部分
    location /api/ {  # 添加末尾斜杠
        proxy_pass http://127.0.0.1:8000/api/;  # 添加 /api/
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/translation.jtcargo.co.id/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/translation.jtcargo.co.id/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}
server {
    if ($host = translation.jtcargo.co.id) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    listen 80;
    server_name translation.jtcargo.co.id;
    return 404; # managed by Certbot


}